<div class="container my-bg-color">
  <div class="row top_buffer_my">
    <div class="col-lg-8 order-lg-1 mb-3 bottom_buffer_mobile_tr_index no-paddings">
      <h2 id="month">
        <div class="date-my">
          <%= link_to "<", date: @date.prev_month %>
        </div>
      <div  class="date-my button_position ">
        <% if @date.month != Date.today.month %>
          <%= link_to(image_pack_tag("home_white.png", alt: 'home', class: 'img-home-white'), date: Date.today) %>
        <% end %>
      </div>
        <div class="date-my date-width-my">
          <%= l(@date, format: "%B, %Y") %>
        </div>
        <div class="date-my">
          <%= link_to ">", date: @date.next_month %>
        </div>
      </h2>

      <%= calendar @date do |date| %>
        <%= date.day %>
        <div>
          <% if @trainings_by_date[date] %>
            <% @trainings_by_date[date].each do |training| %>
              <div class=" date-my">
                <% if Training.pics[training.label&.downcase&.to_sym] %>  
                  <%= link_to(image_pack_tag(Training.pics[training.label.downcase.to_sym], alt: 'logo', class: 'img-calendar'), training) %>
                <% else  %>
                  <%= link_to training.label.truncate(29), training, class: 'cal-font' %>
                <% end %>
              </div>
            <% end %> 
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="border col-lg-3 order-lg-2 buffer-top bg-light buffer-both-sm no-margins max_height_month_tr top_buffer_mobile">
      <div class="mt-1">
        <% unless @trainings_by_month.empty? %>
          <div>Тренировки в этом месяце (<%= "#{@trainings_by_month.count}" %>):</div>
        <% end %>

        <% @trainings_by_month.each do |training| %>
          <div class="tr_display">
            <% if training != @trainings_by_month.last %>
              <%= link_to "#{training.label}, ", training %>
            <% else %>
              <%= link_to training.label, training %>
            <% end %>
          </div>

        <% end %>
      </div>
    </div>
    
  </div>
</div>

<script>
  function current_month(month) {
    let answer = true;
    if (month.is('.notmonth') || (month.is('.notmonth.today'))) {
      answer = false;
    }
    return answer;
  };

  $(function(){
    $(".calendar td").click(function() {
      answer = current_month ($(this));

      if (answer == false) {
        alert('Чтобы создать/отредактировать тренировку в другом месяце, перейдите в него')
        return false;
      }
      else {
        if (!$(this).find("a").length > 0) {
          location = "/trainings/new?day=" + $(this).text().replace(/\s/g, "");
        }
        else {
          location = $(this).find("a").attr('href');
        }
      }
     });

    $(".calendar td").hover(function() {
      answer = current_month ($(this));

      if (answer == true) {
        if (!$(this).find("a").length > 0) {
          $(this).attr('title', 'Создать тренировку ' + $(this).text().replace(/\D+/g, "") + ' числа');
        }
        else {
          $(this).attr('title', 'Тренировка от ' + $(this).text().replace(/\D+/g, "") + ' числа');
        }
      }
      else {
        $(this).attr('title', 'Чтобы создать/отредактировать тренировку в другом месяце, перейдите в него');
        return false;
      }
    });
  });
</script>
